@{
    ViewBag.Title = "Index";
}

<h2>Index2</h2>

<div class="row">
    <div class="col-md-12">
        <table class="table table-striped" id="myTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                <tr>
            </tbody>
        </table>
    </div>
</div>
@section scripts{
<script src="~/Scripts/jquery.signalR-2.2.0.js"></script>
<script src="/signalr/hubs"></script>
<!--Reference the autogenerated SignalR hub script. -->


<script type="text/javascript">
    $(function () {
        // Declare a proxy to reference the hub.
        var notifications = $.connection.notificationHub;

        //debugger;
        // Create a function that the hub can call to broadcast messages.
        notifications.client.updateMessages = function () {
            getNewMessages()

        };
        // Start the connection.
        $.connection.hub.start().done(function () {
            alert("connection started")
            getAllMessages();
        }).fail(function (e) {
            alert(e);
        });
    });


    function getAllMessages() {
        $.ajax({
            url: '/Home/GetMessages',
            type: 'POST',
            dataType: 'json'
        }).success(function (result) {
            console.log(result);
            var list = result.list;
            $.each( list , function(i , val){
                $('#myTable tr:last').after('<tr><td>' + val.name + '</td><td>' + val.data + '</td></tr>');
            })
        }).error(function () {

        });
    }
    function getNewMessages() {
        $.ajax({
            url: '/Home/GetNewMessages',
            type: 'POST',
            dataType: 'json'
        }).success(function (result) {
            console.log(result);
            var list = result.obj;
            $.each(list, function (i, val) {
                $('#myTable tr:last').after('<tr><td>' + val.name + '</td><td>' + val.data + '</td></tr>');
            })
        }).error(function () {

        });
    }
</script>
}